@model GestaoObras.Web.Models.DashboardVM
@{
    ViewData["Title"] = "Dashboard";
    ViewData["Icon"]  = "fa-solid fa-gauge-high";

    // Helpers locais (apenas para esta view)
    string BadgeClass(string op) => op == "Entrada" ? "bg-success" : "bg-danger";
    string BadgeText(string op)  => op == "Entrada" ? "Entrada" : "Saída";
}

<section class="content pt-4 pb-4">
  <div class="container-fluid">

    <!-- KPIs -->
    <div class="row g-3">
      <div class="col-12 col-sm-6 col-lg-3">
        <div class="small-box bg-info shadow-sm">
          <div class="inner">
            <h3>@Model.ObrasAtivas</h3>
            <p>Obras ativas</p>
          </div>
          <div class="icon"><i class="fa-solid fa-hard-hat" aria-hidden="true"></i></div>
          <a asp-controller="Obras" asp-action="Index" class="small-box-footer" aria-label="Ver obras">
            Ver mais <i class="fa-solid fa-arrow-circle-right" aria-hidden="true"></i>
          </a>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="small-box bg-success shadow-sm">
          <div class="inner">
            <h3>@Model.ClientesTotal</h3>
            <p>Clientes</p>
          </div>
          <div class="icon"><i class="fa-solid fa-users" aria-hidden="true"></i></div>
          <a asp-controller="Clientes" asp-action="Index" class="small-box-footer" aria-label="Ver clientes">
            Ver mais <i class="fa-solid fa-arrow-circle-right" aria-hidden="true"></i>
          </a>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="small-box bg-warning shadow-sm">
          <div class="inner">
            <h3>@Model.MateriaisTotal</h3>
            <p>Materiais</p>
          </div>
          <div class="icon"><i class="fa-solid fa-boxes-stacked" aria-hidden="true"></i></div>
          <a asp-controller="Materiais" asp-action="Index" class="small-box-footer" aria-label="Ver materiais">
            Ver mais <i class="fa-solid fa-arrow-circle-right" aria-hidden="true"></i>
          </a>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="small-box bg-danger shadow-sm">
          <div class="inner">
            <h3>@Model.MovimentosHoje</h3>
            <p>Movimentos hoje</p>
          </div>
          <div class="icon"><i class="fa-solid fa-right-left" aria-hidden="true"></i></div>
          <a asp-controller="MovimentosMaterial" asp-action="Index" class="small-box-footer" aria-label="Ver movimentos">
            Ver mais <i class="fa-solid fa-arrow-circle-right" aria-hidden="true"></i>
          </a>
        </div>
      </div>
    </div>

    <!-- Últimos movimentos -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title mb-0">
          <i class="fa-solid fa-rotate-right me-2" aria-hidden="true"></i>Últimos movimentos
        </h3>
      </div>

      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm table-striped table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th scope="col">Data</th>
                <th scope="col">Obra</th>
                <th scope="col">Material</th>
                <th scope="col">Operação</th>
                <th scope="col" class="text-end">Qtd</th>
              </tr>
            </thead>
            <tbody>
            @if (!Model.UltimosMovimentos.Any())
            {
              <tr>
                <td colspan="5" class="text-center text-muted py-4">
                  Sem movimentos recentes.
                </td>
              </tr>
            }
            else
            {
              foreach (var m in Model.UltimosMovimentos)
              {
                <tr>
                  <td>@m.Data.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</td>
                  <td>@m.Obra</td>
                  <td>@m.Material</td>
                  <td>
                    <span class="badge @BadgeClass(m.Operacao)">@BadgeText(m.Operacao)</span>
                  </td>
                  <td class="text-end">@m.Quantidade</td>
                </tr>
              }
            }
            </tbody>
          </table>
        </div>
      </div>

      <div class="card-footer text-end">
        <a class="btn btn-sm btn-outline-secondary"
           asp-controller="MovimentosMaterial" asp-action="Index" aria-label="Ver todos os movimentos">
          Ver todos
        </a>
      </div>
    </div>

  </div>
</section>